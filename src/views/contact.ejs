<!DOCTYPE html>
<html lang="en">
<%- include('partials/head', { title: 'Contact' }) %>
<body>
  <%- include('partials/header') %>

  <h1 style="display: none;">Contact Form</h1>

  <div class="container my-5">
    <h2 class="mx-auto my-5" style="max-width: 500px" id="contact-title">
      Contact Form
    </h2>
    <form
      class="mx-auto my-5"
      style="max-width: 500px"
      id="contactForm"
      method="POST"
    >
      <div class="form-group">
        <label for="name" class="form-label">Name</label>
        <input
          type="text"
          id="name"
          name="name"
          class="form-control"
          required
          placeholder="Enter your name"
        />
      </div>
      <div class="form-group">
        <label for="email" class="form-label">Email</label>
        <input
          type="email"
          id="email"
          name="email"
          class="form-control"
          required
          placeholder="Enter your email"
        />
      </div>
      <div class="form-group">
        <label for="message" class="form-label">Message</label>
        <textarea
          id="message"
          name="message"
          class="form-control"
          rows="5"
          required
          placeholder="Your message here"
        ></textarea>
      </div>
      <div class="g-recaptcha" data-sitekey="<%= recaptchaSiteKey %>" data-callback="onReCaptchaSuccess"></div>
      <div class="form-group">
        <button type="submit" class="btn btn-primary btn-block my-3">
          Submit
        </button>
      </div>
    </form>
    <%- include('partials/scripts') %>
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
    <script>
      // Callback function to handle the form submission after reCAPTCHA success
      function onReCaptchaSuccess(token) {
        var formData = $('#contactForm').serialize()
        formData += '&g-recaptcha-response=' + token

        // Ajax post to the server with the form data and the reCAPTCHA token
        $.ajax({
          type: "POST",
          url: "/contact",
          data: formData,
          dataType: "text",
          success: function () {
            // Update the UI to show a success message
            $("#contact-title").html("<h2>Thanks!</h2>")
            $("#contactForm").html("<p>I'll get back to you as soon as possible.</p>")
          },
          error: function (xhr, status, error) {
            // Log the error and update the UI to show an error message
            console.error("Error in form submission:", status, error)
            $("#contact-title").html("<h2>Oh no!</h2>")
            $("#contactForm").html("<p>There was an error with your submission. Please refresh and try again.</p>")
          }
        });
      }

      // Document ready function to attach the submit event handler to the form
      $(document).ready(function() {
        $('#contactForm').on("submit", function (event) {
          event.preventDefault()
        })
      });
    </script>
  </div>
  <%- include('partials/footer') %>
</body>
</html>
